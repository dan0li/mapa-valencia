# Dataset

El dataset de este repositorio se basa en dos fuentes de datos. La primera fuente de datos es idealista18 (https://paezha.github.io/idealista18/index.html), un conjunto de datos públicos que publicó idealista y contiene información acerca de viviendas vendidas en 2018 de tres grandes ciudades de España: Madrid, Barcelona y Valencia. La segunda fuente de datos que se utiliza en este trabajo se trata de los datos de los puntos de interés que podemos obtener a partir de OpenStreetMap (https://www.openstreetmap.org).

## Creación del dataset para la visualización de mapas

El dataset utilizado para la posterior visualización en el mapa se puede encontrar en su totalidad en la carpeta `dataset`. De forma más especídifca, los archivos utilizados para representar los puntos en el mapa son `dataset/Barrios_valencia.geojson` para representar las fornteras de cada barrio en Valencia, `dataset/colegios_por_barrio.csv`, `dataset/hospitales_por_barrio.csv` , `dataset/parques_por_barrio.csv`, `dataset/bus_por_barrio.csv`, `dataset/tram_por_barrio.csv` para representar los diferentes puntos de interés que han sido considerados y, finalmente, `dataset/DATASET_FINAL.json` para representar los pisos y sus características.

Para la optención de todos estos datasets hemos seguido el flujo de trabajo que se puede encontrar en el notebook `creacion_dataset.ipynb`. En este notebook hacemos uso del dataset de idealista18, el cual limpiamos y filtramos para hacer uso únicamente de los pisos que pertenecen a la ciudad de Valencia. Además, descargamos la información de los diferentes puntos de interés (POI) como colegios, hospitales o parques, así como la información geográfica de los barrios de Valencia, a partir de la librería osmnx (https://osmnx.readthedocs.io/en/stable/) la cual nos permite acceder a la información de OpenStreetMap. Una vez tenemos la información de los POI y los barrios, modificamos los datasets de los POI y de los pisos para identificarlos según el barrio al cual pertenezcan y también calculamos las distacias de cada piso al POI correspondiente más cercano. Finalmente, en el notebook hay un apartado para guardar las rutas que se usarán más tarde en la visualización del mapa de la ciudad de Valencia, esto es debido a que las rutas se obtienen a partir de hacer llamadas a la API de OpenRouteService (https://openrouteservice.org/), la cual tiene un límete de 2000 peticiones diarias. En este apartado del notebook está el código para guardar las rutas de los pisos en función del barrio al que pertenecen, es por eso que algunos de los barrios ya tienen guardadas las rutas en el dataset que se utliza en la representación del mapa, de esta forma evitamos exceder el límite de peticiones a la API.

# Visualización del mapa

El código para la visualización del mapa está en el notebook `mapa.ipynb`. El resultado de este código es un mapa de Valencia dividido por barrios pero que inicialmente no muestra ningún piso ni POI, si no que hay que seleccionar los barrios de los que se quieren ver estos datos en el panel flotante que hay en lateral izquierdo. El mapa se inicializa vacio porque el dataset completo es bastante grande y utiliza una gran cantidad de memoria mostrar toda la información en el mapa. Una vez se seleccionan los barrios de los que se desea ver la información, aparecerán todos los pisos y POI de estos barrios. Los POI tienen iconos personalizados para cada tipo, mientras que los pisos son simples puntos azules. Al hacer click sobre un POI aparecerá un pop up sobre este en el que se podrá leer el nombre de este, estos pop ups se cerrarán automáticamente al hacer cliclk sobre otro marcador del mapa o bien al hacer click sobre el propio mapa. Al hacer click sobre un piso se abrirá un panel lateral en que aparecerá información relevente del piso como el precio, el número de habitaciones o los metros cuadrados que tiene. Además, en este panel lateral dispondrá de tres botones para dibujar las rutas más cercanas al piso, uno para cada POI: colegio, hospital y parque. En estos botones puede aparecer o no el tiempo que tarda cada ruta, dependiendo de si se trata de un barrio cuyas rutas estén preguardadas o no, ya que el tiempo es obtenido a partir de la lla mada a la API de OpenRouteService por lo que no podemos saber el tiempo de las rutas antes de hacer dicha llamada. En su lugar, para los pisos cuyas rutas no estén preguardadas, los tiempos de cada ruta aprecerán sobre las mismas rutas una vez se haga click sobre el botón.

Para la visualización del mapa en pantalla completa se recomienda el uso de herramientas como Voilà (https://github.com/voila-dashboards/voila), que nos permite transformar el notebook en una aplicación web HTML. Esta herramienta es parecida a Streamlit, pero esta no ha podido ser utilizada ya que no soporta la libreria de ipyleaflet, la cual es usada como base para la creación del mapa.
